# Nav2 Mission Configuration for CostNav
# This file configures the automated mission orchestration system.
#
# Usage:
#   python launch.py --mission                    # Uses this default config
#   python launch.py --mission --config custom.yaml  # Uses custom config

# Mission execution settings
mission:

  # Mission timeout (seconds)
  timeout: null  # No timeout (use a float number like 3600.0 for 1 hour)

# Distance constraints for start/goal sampling (in meters)
distance:
  # Minimum distance between start and goal positions
  min: 20.0

  # Maximum distance between start and goal positions
  max: 1000.0

# Nav2 integration settings
nav2:
  # Time to wait for Nav2 stack to initialize (seconds)
  wait_time: 10.0

  # Delay after setting initial pose before publishing goal (seconds)
  initial_pose_delay: 2.0

  # Topic names for Nav2 communication
  topics:
    initial_pose: "/initialpose"
    goal_pose: "/goal_pose"
    odom: "/chassis/odom"

# Robot teleportation settings
teleport:
  # Height offset when teleporting robot (meters)
  height_offset: 0.1

  # Robot prim path in USD stage (chassis_link prim for direct teleportation)
  robot_prim: "/World/Nova_Carter_ROS/chassis_link"

# RViz marker visualization settings
markers:
  # Enable/disable marker publishing
  enabled: true

  # Marker topic names
  topics:
    start: "/start_marker"
    goal: "/goal_marker"

  # Marker sizes (meters)
  scale:
    arrow_length: 10.0
    arrow_width: 3.0
    arrow_height: 3.0

# Sampling settings
sampling:
  # Maximum attempts to find valid start/goal pair
  max_attempts: 100

  # Require valid path between start and goal
  validate_path: true

  # Minimum distance from navmesh edges for sampled positions (meters)
  # Prevents sampling positions too close to boundaries
  edge_margin: 1.0

# Food evaluation settings (for delivery missions)
# NOTE: Currently only segway_e1 robot is supported for food evaluation.
# For other robots, implement robot-specific positioning in MissionManager._setup_food_tracking()
food:
  # Enable food spoilage evaluation (only works with segway_e1)
  enabled: true

  # Prim path where the food is spawned in the stage
  prim_path: "/World/Food"

  # Relative path to the pieces prim under food prim
  pieces_prim_path: "PopcornPieces"

  # Relative path to the bucket/container prim under food prim
  bucket_prim_path: "PopcornBucket"

  # Fraction of pieces that can be lost before mission fails (0.0 = no loss, 0.05 = 5% loss allowed)
  spoilage_threshold: 0.05

injury:
  enabled: true
  method: "delta_v"
  crash_mode: "all"
  robot_mass: 50.0  # Robot mass in kg for delta-v = impulse / mass calculation
  robot_height: null
  pedestrian_height: null
  costs:
    mais_0: 380.0
    mais_1: 8487.0
    mais_2: 60464.0
    mais_3: 261200.0
    mais_4: 0.0  # Delivery robot context: MAIS 4+ not modeled (report covers motor vehicles)
    mais_5: 0.0  # Delivery robot context: MAIS 4+ not modeled (report covers motor vehicles)
    fatality: 0.0  # Delivery robot context: MAIS 4+ not modeled (report covers motor vehicles)

# Goal image settings (for ViNT ImageGoal mode)
goal_image:
  # Enable goal image publishing for ViNT ImageGoal mode
  enabled: false

  # Topic to publish goal images
  topic: "/goal_image"

  # Goal image dimensions (matches ViNT input)
  width: 640
  height: 360

  # Camera height offset from ground (meters)
  camera_height_offset: 0.3

  # USD prim path for goal camera
  camera_prim_path: "/World/goal_camera"

# Topomap generation settings (NavMesh-based)
# Generates ViNT-compatible topological maps by capturing images along NavMesh shortest paths
topomap:
  # Enable automatic topomap generation from NavMesh paths
  enabled: false

  # Distance between waypoints along the path (meters)
  waypoint_interval: 2.0

  # Camera height offset from ground (meters)
  camera_height_offset: 0.3

  # Image dimensions (matches ViNT input)
  image_width: 640
  image_height: 360

  # Output directory for generated topomap images
  output_dir: "/tmp/costnav_topomap"

  # USD prim path for topomap camera
  camera_prim_path: "/World/topomap_camera"

  # Number of simulation steps per image capture (for render pipeline flush)
  render_settle_steps: 3

  # Robot prim path to hide during image capture (prevents robot from appearing in images)
  # If not set, falls back to teleport.robot_prim
  # robot_prim_path: "/World/Nova_Carter_ROS"

  # Camera intrinsics (matching rgb_left.usda)
  focal_length: 2.87343
  horizontal_aperture: 5.76
  vertical_aperture: 3.6
  focus_distance: 0.6

# MissionManager runtime settings
# These control the mission execution behavior
manager:
  # Distance constraints (if not specified, uses values from distance section)
  # min_distance: 20.0
  # max_distance: 1000.0

  # Sampling margin from navmesh edges (if not specified, uses value from sampling.edge_margin)
  # edge_margin: 1.0

  # Delays for Nav2 pose initialization
  # initial_pose_delay: 2.0  # Uses nav2.initial_pose_delay if not specified
  goal_delay: 0.5  # Delay after publishing goal (seconds)

  # Teleportation settings
  # teleport_height: 0.1  # Uses teleport.height_offset if not specified
  # robot_prim_path: "/World/Nova_Carter_ROS/chassis_link"  # Uses teleport.robot_prim if not specified
  teleport_settle_steps: 30  # Number of simulation steps after teleportation for physics to settle

  # Nav2 costmap clearing (useful when teleporting between missions)
  clear_costmaps_on_mission_start: true
  costmap_clear_timeout_sec: 2.0  # Max time to wait for clear service responses
